<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Density-dependent habitat use • guppyDme</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Density-dependent habitat use">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">guppyDme</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Analyses

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DME-000_Tidy_data.html">Tidy the Data</a>
    </li>
    <li>
      <a href="../articles/DME-011_Measurement_consistency.html">Measurement Consistency</a>
    </li>
    <li>
      <a href="../articles/DME-010_Habitat_characteristics.html">Habitat Characteristics</a>
    </li>
    <li>
      <a href="../articles/DME-015_Habitat_area.html">Habitat Area</a>
    </li>
    <li>
      <a href="../articles/DME-016_Dispersal_and_habitat_shift.html">Dispersal and Habitat shift</a>
    </li>
    <li>
      <a href="../articles/DME-020_Density_dependence.html">Density Dependence</a>
    </li>
    <li>
      <a href="../articles/DME-030_Habitat_use.html">Habitat Use</a>
    </li>
    <li>
      <a href="../articles/DME-035_DD_habitat_use.html">Density-Dependent Habitat Use</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sebastianodebona/guppyDme" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Density-dependent habitat use</h1>
                        <h4 data-toc-skip class="author">Seba De
Bona</h4>
            
      

      <div class="hidden name"><code>DME-035_DD_habitat_use.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview-and-setup">Overview and Setup<a class="anchor" aria-label="anchor" href="#overview-and-setup"></a>
</h2>
<p>In this vignette, we build up on the <a href="DME-030_Habitat_use.html">previous vignette</a>, adopting again a
Discrete-Choice model approach but including density as an independent
variable and analyzing in one go the capture and recapture data.</p>
<p>In the previous vignette I was trying to generate estimates based on
the capture model, to then predict expected habitat occupancy during the
recapture and compare it with the observed occupancy. No clear, visible
trend is visible using that approach, therefore, having a somwhat more
complicated d-c model that includes density in the first place might
shade some light on that.</p>
<p>When analysing capture and recapture at the same time, we create a
mismatch between individuals and choice situation. Now <code>id</code>
and <code>chid</code> have to be defined separately, and what I will do
is to assign <code>chid</code> a value corresponding to 1 for capture
and 2 for recapture. What’s important, is to account correctly for
individuals that are analysed twice: if an individual is recaptured,
it’s id should be the same. The density experienced is a choice
situation specific covariate: the density factor associated with the
capture will always be 1 (since all pools were assumed to be at
equilibrium before being manipulated).</p>
<p>In the analyses here I will adopt the joint model, considering how
close the results with the split model were (and the joint is
easier).</p>
</div>
<div class="section level2">
<h2 id="required-packages-and-data">Required packages and Data<a class="anchor" aria-label="anchor" href="#required-packages-and-data"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loading required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'ggplot2' was built under R version 4.3.2</span></span></code></pre>
<pre><code><span><span class="co">## Warning: package 'tidyr' was built under R version 4.3.2</span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.5</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.5.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">## ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'magrittr'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## The following object is masked from 'package:purrr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     set_names</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## The following object is masked from 'package:tidyr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     extract</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">nnet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=mlogit" class="external-link">mlogit</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: dfidx</span></span></code></pre>
<pre><code><span><span class="co">## Warning: package 'dfidx' was built under R version 4.3.3</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dfidx'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/schaffman5/rtf" class="external-link">rtf</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'rtf'</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## The following object is masked from 'package:purrr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     done</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## The following object is masked from 'package:tibble':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     view</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this package requires the package guppyDme to be installed. If the user wishes not to install the package, please comment out the "library(guppyDme)" line and run instead the lines commented out below</span></span>
<span></span>
<span><span class="co">#### If you have the guppyDme package installed</span></span>
<span><span class="co"># loading package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sebastianodebona.github.io/guppyDme/">guppyDme</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># # If you do NOT wish to install the guppyDme package, please uncomment and run the following two lines of code, adding the package functions to the Global Environment and loading the data</span></span>
<span><span class="co"># source(file.path(here::here(), "R", "package_functions.R"))</span></span>
<span><span class="co"># load(file.path(here::here(), "data", "DMEdata.rda"))</span></span>
<span></span>
<span><span class="co"># loading data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">DMEdata</span></span>
<span><span class="va">pool_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignettes"</span>, <span class="st">"DME_pool_composition.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">treatment_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignettes"</span>, <span class="st">"DME_density_factor_in_treatments.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># I am creating an additional column in the dataset, redefining sex_stage classes</span></span>
<span><span class="co"># I am also transforming SL into numeric, substituting the "&lt;10", and </span></span>
<span><span class="co"># every numeric value below 10mm, with a numeric `set_value`.</span></span>
<span><span class="va">set_value</span> <span class="op">&lt;-</span> <span class="fl">9</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>SL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">SL</span>, <span class="va">SL</span> <span class="op">==</span> <span class="st">"&lt;10"</span>, <span class="va">set_value</span><span class="op">)</span>,</span>
<span>         SL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">SL</span><span class="op">)</span>,</span>
<span>         SL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">SL</span>, <span class="va">SL</span> <span class="op">&lt;</span> <span class="fl">10</span>, <span class="va">set_value</span><span class="op">)</span>,</span>
<span>         sex_stage <span class="op">=</span> <span class="fu">score_sexst</span><span class="op">(</span><span class="va">.</span>, f_threshold <span class="op">=</span> <span class="fl">14</span>, f_unit <span class="op">=</span> <span class="st">"SL"</span><span class="op">)</span>,</span>
<span>         sex_stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sex_stage</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"I"</span>, <span class="st">"M"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 3 warnings in `mutate()`.</span></span>
<span><span class="co">## The first warning was:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `SL = as.numeric(SL)`.</span></span>
<span><span class="co">## Caused by warning:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> NAs introduced by coercion</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 2 remaining warnings.</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="data-handling">Data handling<a class="anchor" aria-label="anchor" href="#data-handling"></a>
</h2>
<p>We am using, once again, this <a href="https://cran.r-project.org/web/packages/mlogit/vignettes/c2.formula.data.html" class="external-link">vignette</a>
to guide the decision on data handling and model construction.</p>
<p>Below, we include pool composition info (relative benthic area for
each habitat present) and density information (which is 1 for every pool
at capture, and corresponds to the modified density during the
recap).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adding pool composition info</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">pool_comp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>recap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">cap_recap</span> <span class="op">==</span> <span class="st">"cap"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">recap</span>, <span class="va">streamID</span>, <span class="va">patchID</span>,</span>
<span>         A <span class="op">=</span> <span class="va">relA</span>, B <span class="op">=</span> <span class="va">relB</span>, C <span class="op">=</span> <span class="va">relC</span>, D <span class="op">=</span> <span class="va">relD</span>, E <span class="op">=</span> <span class="va">relE</span>, tot_ba <span class="op">=</span> <span class="va">tot</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Adding missing grouping variables: `cap_recap`</span></span>
<span><span class="co">## Joining with `by = join_by(streamID, recap, patchID)`</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adding density info</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">treatment_tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span>recap <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">treatment</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>pool_density <span class="op">=</span> <span class="va">density_factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pool_density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">recap</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="va">pool_density</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(streamID, recap, patchID)`</span></span></code></pre>
<p>The dataset now contains a lot of information that we don’t need, so
we can trim it down. We need to include a variable for individual
<code>id</code> and a variable for <code>chid</code>. When doing this,
we need to be careful with the id assigned to cohort marks. If we were
to simply use the <code>markID</code> variable to generate id, all
cohort marks will be considered as repeated measures of the same
individual.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># trimming only the needed data</span></span>
<span><span class="co"># - excluding Taylor mouth</span></span>
<span><span class="co"># - excluding undefined habitat</span></span>
<span><span class="va">hdata</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">streamID</span> <span class="op">!=</span> <span class="st">"TM"</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">habitat</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">markID</span>, <span class="va">SL</span>, <span class="va">sex_stage</span>, <span class="va">habitat</span>, <span class="va">pool_density</span>, <span class="va">recap</span>, <span class="va">isbabyMark</span>, <span class="va">isCohort</span>,</span>
<span>         <span class="va">A</span>, <span class="va">B</span>, <span class="va">C</span>, <span class="va">D</span>, <span class="va">E</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># here I will extract all individuals who have more than 1</span></span>
<span><span class="co"># record per cap/recap</span></span>
<span><span class="va">not_unique_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">hdata</span><span class="op">$</span><span class="va">markID</span>, <span class="va">hdata</span><span class="op">$</span><span class="va">recap</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Freq</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Var1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to assign unique ids, first I generate a column of actually unique ids</span></span>
<span><span class="co"># that are above the maximum number of unique markIDs</span></span>
<span><span class="co"># then, I can draw unique values from this column for individuals</span></span>
<span><span class="co"># that don't already have a unique id</span></span>
<span><span class="va">hdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>bench_id <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">markID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">markID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">markID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">not_unique_ids</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">markID</span><span class="op">)</span>, <span class="va">bench_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>chid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">bench_id</span><span class="op">)</span></span></code></pre></div>
<p>Now we are transforming the data into the long format, to allow for
the set of alternative to vary amonge choices (see <a href="https://cran.r-project.org/web/packages/mlogit/vignettes/c2.formula.data.html" class="external-link">here</a>
).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reshaping it as a long format</span></span>
<span><span class="va">hdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, <span class="va">C</span>, <span class="va">D</span>, <span class="va">E</span>, key <span class="op">=</span> <span class="st">"alt"</span>, value <span class="op">=</span> <span class="st">"ba"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>choice <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">habitat</span> <span class="op">==</span> <span class="va">alt</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">chid</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">chid</span>, <span class="va">markID</span>, <span class="va">alt</span>, <span class="va">choice</span>, <span class="va">SL</span>, <span class="va">sex_stage</span>, <span class="va">ba</span>, <span class="va">pool_density</span>, <span class="va">recap</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ba</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdata</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">##      id  chid markID alt   choice    SL sex_stage    ba pool_density recap</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     2     1 105Y   A          0  23.4 F         0.428            1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2     1 105Y   B          0  23.4 F         0.265            1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     2     1 105Y   C          1  23.4 F         0.162            1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     2     1 105Y   D          0  23.4 F         0.145            1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     3     2 1B     A          0  11.6 I         0.428            1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     3     2 1B     B          0  11.6 I         0.265            1     0</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># re-centering pool_density, creating factorial treatment</span></span>
<span><span class="va">hdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pool_density <span class="op">=</span> <span class="va">pool_density</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>         treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pool_density</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"control"</span>,</span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pool_density</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"increased"</span>, <span class="st">"decreased"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># I need to make sure that every individuals has a decision assigned.</span></span>
<span><span class="co"># In the case an individual was found in a habitat at ba 0, this would not be the case</span></span>
<span><span class="co"># of course, such instance would be a mistake, and should be fixed.</span></span>
<span><span class="va">n_rows</span> <span class="op">&lt;-</span> <span class="va">hdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">markID</span>, <span class="va">chid</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>didPick <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">choice</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">didPick</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'id', 'markID'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check to see if any fish did not decide</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">n_rows</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co"># all good</span></span></code></pre></div>
<p>We can now transform the data in the appropriate format with the
function <code><a href="https://rdrr.io/pkg/mlogit/man/mlogit-deprecated.html" class="external-link">mlogit.data()</a></code>, and we are ready for the
analysis.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_mlogit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit-deprecated.html" class="external-link">mlogit.data</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">hdata</span><span class="op">)</span>, shape <span class="op">=</span> <span class="st">"long"</span>, </span>
<span>                      alt.var <span class="op">=</span> <span class="st">"alt"</span>, id.var <span class="op">=</span> <span class="st">"id"</span>, chid.var <span class="op">=</span> <span class="st">"chid"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>We need to be careful about how we specify the formula. One of
<code>package:mlogit</code>’s own <a href="https://cran.r-project.org/web/packages/mlogit/vignettes/c2.formula.data.html" class="external-link">vignettes</a>
has a pretty clear guide.</p>
<p>The formula is split in three parts separated by the symbol
<code>|</code>., in the form</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>formula <span class="ot">=</span> response <span class="sc">~</span> part I <span class="sc">|</span> part II <span class="sc">|</span> part III</span></code></pre></div>
<p>The three parts represent 3 different tipe of variables:</p>
<ul>
<li>part I correponds to alternative-specific covariates with generic
coefficient (the value of which is consistent across alternatives,
e.g. money is always the same)</li>
<li>part II correponds to choice-situation-specific covariates, that
change among choices but apply to all alternatives in that choice</li>
<li>part III correponds to alternative-specific covariates with
alternative-specific coefficients (i.e. if time spent in a transport
mattered differently: 10 minutes in public transport are fine, but 10
minutes walking are less preferable)</li>
</ul>
<p>In our analyses, all we have are part I (benthic area
<code>ba</code>) and part II (standard length <code>SL</code>, sex
<code>sex_stage</code> and density <code>pool_density</code>). We might
try to introduce also whether the choice was made in the capture or the
recapture (<code>recap</code>), which would also fall into part II.</p>
<p>Let’s try and run the model.</p>
<p>NOTE: in contrast with what done before, we are here not running a
model with treatment as a factor because the model will not converge.
The number of interactions is likely a little too big.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dcmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit.html" class="external-link">mlogit</a></span><span class="op">(</span><span class="va">choice</span> <span class="op">~</span> <span class="va">ba</span> <span class="op">|</span> <span class="va">SL</span> <span class="op">*</span> <span class="va">sex_stage</span> <span class="op">*</span> <span class="va">pool_density</span>, <span class="va">data_mlogit</span>, reflevel <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dcmodel</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## mlogit(formula = choice ~ ba | SL * sex_stage * pool_density, </span></span>
<span><span class="co">##     data = data_mlogit, reflevel = "A", method = "nr")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Frequencies of alternatives:choice</span></span>
<span><span class="co">##        A        B        C        D        E </span></span>
<span><span class="co">## 0.139325 0.142653 0.503566 0.148359 0.066096 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## nr method</span></span>
<span><span class="co">## 7 iterations, 0h:0m:1s </span></span>
<span><span class="co">## g'(-H)^-1g = 2.4E-06 </span></span>
<span><span class="co">## successive function values within tolerance limits </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients :</span></span>
<span><span class="co">##                   Estimate  Std. Error z-value  Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept):B    1.1674167   0.8991584  1.2983 0.1941692    </span></span>
<span><span class="co">## (Intercept):C    2.3176553   0.5301321  4.3718 1.232e-05 ***</span></span>
<span><span class="co">## (Intercept):D    5.3399777   1.6773118  3.1837 0.0014543 ** </span></span>
<span><span class="co">## (Intercept):E    6.1904968   1.2523596  4.9431 7.690e-07 ***</span></span>
<span><span class="co">## ba               2.5159554   0.2359196 10.6645 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## SL:B            -0.1099154   0.0429682 -2.5581 0.0105257 *  </span></span>
<span><span class="co">## SL:C            -0.0899314   0.0244970 -3.6711 0.0002415 ***</span></span>
<span><span class="co">## SL:D            -0.3632761   0.0934348 -3.8880 0.0001011 ***</span></span>
<span><span class="co">## SL:E            -0.3734266   0.0682696 -5.4699 4.503e-08 ***</span></span>
<span><span class="co">## sex_stageI:B     6.4004604   1.1942450  5.3594 8.349e-08 ***</span></span>
<span><span class="co">## sex_stageI:C     2.5702891   0.8800267  2.9207 0.0034925 ** </span></span>
<span><span class="co">## sex_stageI:D     4.3141214   1.8716277  2.3050 0.0211660 *  </span></span>
<span><span class="co">## sex_stageI:E    -2.5065488   1.5053299 -1.6651 0.0958896 .  </span></span>
<span><span class="co">## sex_stageM:B    -0.2363717   3.5323526 -0.0669 0.9466484    </span></span>
<span><span class="co">## sex_stageM:C    -1.1718102   2.4614838 -0.4761 0.6340327    </span></span>
<span><span class="co">## sex_stageM:D     8.1603652   6.7204897  1.2143 0.2246517    </span></span>
<span><span class="co">## sex_stageM:E     4.3636107   6.0600425  0.7201 0.4714864    </span></span>
<span><span class="co">## pool_density:B   0.1782479   3.2920565  0.0541 0.9568198    </span></span>
<span><span class="co">## pool_density:C   0.6107412   2.0200165  0.3023 0.7623893    </span></span>
<span><span class="co">## pool_density:D   8.0267115   7.3670819  1.0895 0.2759170    </span></span>
<span><span class="co">## pool_density:E  -1.1580577   7.5099624 -0.1542 0.8774498    </span></span>
<span><span class="co">## SL:B            -0.3983090   0.0737992 -5.3972 6.769e-08 ***</span></span>
<span><span class="co">## SL:C            -0.1499731   0.0548431 -2.7346 0.0062459 ** </span></span>
<span><span class="co">## SL:D            -0.2915782   0.1145791 -2.5448 0.0109348 *  </span></span>
<span><span class="co">## SL:E             0.1584038   0.0917967  1.7256 0.0844206 .  </span></span>
<span><span class="co">## SL:B             0.0223629   0.2016629  0.1109 0.9117016    </span></span>
<span><span class="co">## SL:C             0.0670554   0.1404813  0.4773 0.6331300    </span></span>
<span><span class="co">## SL:D            -0.5057856   0.4088878 -1.2370 0.2160949    </span></span>
<span><span class="co">## SL:E            -0.3051034   0.3631274 -0.8402 0.4007904    </span></span>
<span><span class="co">## SL:B            -0.0408326   0.1588940 -0.2570 0.7971939    </span></span>
<span><span class="co">## SL:C            -0.0642783   0.0940971 -0.6831 0.4945397    </span></span>
<span><span class="co">## SL:D            -0.5774917   0.3861778 -1.4954 0.1348091    </span></span>
<span><span class="co">## SL:E             0.0962236   0.4251557  0.2263 0.8209482    </span></span>
<span><span class="co">## sex_stageI:B   -11.0498652   4.3096914 -2.5640 0.0103486 *  </span></span>
<span><span class="co">## sex_stageI:C   -12.6920015   3.1995323 -3.9668 7.283e-05 ***</span></span>
<span><span class="co">## sex_stageI:D   -15.7083906   8.3286594 -1.8861 0.0592862 .  </span></span>
<span><span class="co">## sex_stageI:E    -4.2471880   8.6599864 -0.4904 0.6238239    </span></span>
<span><span class="co">## sex_stageM:B     0.4481004  15.6214105  0.0287 0.9771158    </span></span>
<span><span class="co">## sex_stageM:C    -0.2484898  10.7429269 -0.0231 0.9815461    </span></span>
<span><span class="co">## sex_stageM:D   -29.4673109  26.3404714 -1.1187 0.2632645    </span></span>
<span><span class="co">## sex_stageM:E     2.1251563  40.9060792  0.0520 0.9585669    </span></span>
<span><span class="co">## SL:B             0.6843901   0.2755139  2.4840 0.0129898 *  </span></span>
<span><span class="co">## SL:C             0.8220309   0.2079032  3.9539 7.688e-05 ***</span></span>
<span><span class="co">## SL:D             1.1403822   0.5240143  2.1762 0.0295371 *  </span></span>
<span><span class="co">## SL:E             0.3307430   0.5401152  0.6124 0.5403020    </span></span>
<span><span class="co">## SL:B             0.0407358   0.8961742  0.0455 0.9637445    </span></span>
<span><span class="co">## SL:C             0.0997719   0.6147788  0.1623 0.8710782    </span></span>
<span><span class="co">## SL:D             1.9324551   1.5872610  1.2175 0.2234225    </span></span>
<span><span class="co">## SL:E            -0.0097941   2.4021226 -0.0041 0.9967468    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Log-Likelihood: -2178.5</span></span>
<span><span class="co">## McFadden R^2:  0.23859 </span></span>
<span><span class="co">## Likelihood ratio test : chisq = 1365.3 (p.value = &lt; 2.22e-16)</span></span></code></pre>
<p>We will export the output as a doc table.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dcmodel</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "coefficients"  "logLik"        "gradient"      "hessian"      </span></span>
<span><span class="co">##  [5] "est.stat"      "fitted.values" "probabilities" "linpred"      </span></span>
<span><span class="co">##  [9] "indpar"        "residuals"     "omega"         "rpar"         </span></span>
<span><span class="co">## [13] "nests"         "model"         "freq"          "formula"      </span></span>
<span><span class="co">## [17] "call"          "CoefTable"     "lratio"        "mfR2"</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ptable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dcmodel</span><span class="op">)</span><span class="op">$</span><span class="va">CoefTable</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span>coeff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dcmodel</span><span class="op">)</span><span class="op">$</span><span class="va">CoefTable</span><span class="op">)</span><span class="op">)</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">rtffile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtf/man/RTF.html" class="external-link">RTF</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignettes"</span>, <span class="st">"DCM_output.doc"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># this can be an .rtf or a .doc</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rtf/man/Non-documented_objects.html" class="external-link">addTable</a></span><span class="op">(</span><span class="va">rtffile</span>, <span class="va">ptable</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rtf/man/Non-documented_objects.html" class="external-link">done</a></span><span class="op">(</span><span class="va">rtffile</span><span class="op">)</span></span></code></pre></div>
<p>The interpretation of the results is somewhat tricky, so we will plot
the estimated probabilities as done in the previous vignette, but this
time also including the density values.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sls</span> <span class="op">&lt;-</span> <span class="fu">modelr</span><span class="fu">::</span><span class="fu"><a href="https://modelr.tidyverse.org/reference/seq_range.html" class="external-link">seq_range</a></span><span class="op">(</span><span class="va">hdata</span><span class="op">$</span><span class="va">SL</span>, n<span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">sxs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">hdata</span><span class="op">$</span><span class="va">sex_stage</span><span class="op">)</span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.5</span>, <span class="fl">0</span>, <span class="fl">.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># then using expand grid I can create all combinations. </span></span>
<span><span class="co"># Each of them is an hypothetical individual, so whould receive an id</span></span>
<span><span class="va">block</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>SL <span class="op">=</span> <span class="va">sls</span>, sex_stage <span class="op">=</span> <span class="va">sxs</span>, pool_density <span class="op">=</span> <span class="va">ds</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># I can now expand this block to include all possible alternatives</span></span>
<span><span class="co"># here, I am weighing them all the same</span></span>
<span><span class="va">habs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>alt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">hdata</span><span class="op">$</span><span class="va">alt</span><span class="op">)</span>,</span>
<span>                   ba <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span></span>
<span><span class="va">mock_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">habs</span>, <span class="va">block</span>, by <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>We are now ready to generate predictions and plot them.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generating predictions and storing them side by side with the block</span></span>
<span><span class="co"># (which unlike mock_d does not have repeated individuals once per habitat)</span></span>
<span><span class="va">pred_mock</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">block</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">dcmodel</span>, newdata <span class="op">=</span> <span class="va">mock_d</span>, type <span class="op">=</span> <span class="st">"probs"</span><span class="op">)</span></span>
<span>                   <span class="op">)</span></span>
<span></span>
<span><span class="co"># reshaping dataset to long(er) format, and releveling sex_stage</span></span>
<span><span class="va">pred_mock</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, <span class="va">C</span>, <span class="va">D</span>, <span class="va">E</span>, key <span class="op">=</span> <span class="va">habitat</span>, value <span class="op">=</span> <span class="va">probability</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex_stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sex_stage</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### TRIMMING</span></span>
<span><span class="co">##### COPY-PASTING this NOW, REPLACE WITH NEW in_range FUNCTION!</span></span>
<span><span class="va">low_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex_stage</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">SL</span><span class="op">)</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">low_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex_stage</span> <span class="op">==</span> <span class="st">"F"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">SL</span><span class="op">)</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">hi_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex_stage</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">SL</span><span class="op">)</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">hi_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex_stage</span> <span class="op">==</span> <span class="st">"I"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">SL</span><span class="op">)</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_mock</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex_stage</span> <span class="op">==</span> <span class="st">"I"</span> <span class="op">&amp;</span> <span class="va">SL</span> <span class="op">&lt;</span> <span class="va">hi_i</span> <span class="op">|</span></span>
<span>           <span class="va">sex_stage</span> <span class="op">==</span> <span class="st">"F"</span> <span class="op">&amp;</span> <span class="va">SL</span> <span class="op">&gt;</span> <span class="va">low_f</span> <span class="op">|</span></span>
<span>           <span class="va">sex_stage</span> <span class="op">==</span> <span class="st">"M"</span> <span class="op">&amp;</span> <span class="va">SL</span> <span class="op">&gt;</span> <span class="va">low_m</span> <span class="op">&amp;</span> <span class="va">SL</span> <span class="op">&lt;</span> <span class="va">hi_m</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html" class="external-link">mapvalues</a></span><span class="op">(</span><span class="va">pool_density</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decreased"</span>, <span class="st">"control"</span>, <span class="st">"increased"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">treatment</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decreased"</span>, <span class="st">"control"</span>, <span class="st">"increased"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         sex <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html" class="external-link">mapvalues</a></span><span class="op">(</span><span class="va">sex_stage</span>,</span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span>,</span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"immature"</span>, <span class="st">"males"</span>, <span class="st">"females"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>     </span>
<span></span>
<span><span class="co"># plotting</span></span>
<span><span class="va">hcp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred_mock</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">SL</span>, y <span class="op">=</span> <span class="va">probability</span>, colour <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"standard length (mm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#1E88E5"</span>, <span class="st">"#FFC107"</span>, <span class="st">"#004D40"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">habitat</span> <span class="op">~</span> <span class="va">treatment</span>, scales <span class="op">=</span> <span class="st">"free"</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>habitat <span class="op">=</span> <span class="fu">hablab</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hcp</span></span></code></pre></div>
<p><img src="DME-035_DD_habitat_use_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">jpeg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignettes"</span>, <span class="st">"figures"</span>, <span class="st">"habitat_choice.jpeg"</span><span class="op">)</span>,</span>
<span>     width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, units <span class="op">=</span> <span class="st">"in"</span>, res <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">hcp</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## agg_png </span></span>
<span><span class="co">##       2</span></span></code></pre>
<p>A few quick thoughts on what’s going on here:</p>
<ul>
<li><p>The inflow (habitat “A”) is thought to be a good quality habitat
for drift feeding. Drift feeding requires large enough mouths, so we
expect large individuals to benefit from it. We can observe that while
in the control and increased density large females dominate this
habitat, in the decrease treatment this habitat becomes accessible to
relatively large males and immatures as well.</p></li>
<li><p>Large females are seen to abandon the core and swamp area they
occupy at low density to move predominantly in the inflow at high
density. This again can be due to a shift in diet, making use of the
harder to get and probably easier to monopolise drift feeding options,
instead of using highly demanded resources in “everyone’s land” (the
core).</p></li>
<li><p>Small juveniles tend to occupy more central habitats (core and
beach at it associated) at low density, but seem to be relegated to
marginal areas (swamp) when density is high. Swamps at high density seem
a pretty secure habitat, with few large individuals and often
marginal.</p></li>
</ul>
<div class="section level3">
<h3 id="ignoring-sex">Ignoring sex?<a class="anchor" aria-label="anchor" href="#ignoring-sex"></a>
</h3>
<p>Both these results and the <a href="DME-030_Habitat_use.html">previous</a> show a remarkable
consistency among different sexes, whilst most of the variation seem
nudged in the size. We will here run a very similar model to that above,
but ignoring sex_stage.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dcmodel_sexless</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit.html" class="external-link">mlogit</a></span><span class="op">(</span><span class="va">choice</span> <span class="op">~</span> <span class="va">ba</span> <span class="op">|</span> <span class="va">SL</span> <span class="op">*</span> <span class="va">pool_density</span>, <span class="va">data_mlogit</span>, reflevel <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dcmodel_sexless</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## mlogit(formula = choice ~ ba | SL * pool_density, data = data_mlogit, </span></span>
<span><span class="co">##     reflevel = "A", method = "nr")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Frequencies of alternatives:choice</span></span>
<span><span class="co">##        A        B        C        D        E </span></span>
<span><span class="co">## 0.139734 0.142586 0.503327 0.148289 0.066065 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## nr method</span></span>
<span><span class="co">## 6 iterations, 0h:0m:0s </span></span>
<span><span class="co">## g'(-H)^-1g = 4.19E-05 </span></span>
<span><span class="co">## successive function values within tolerance limits </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients :</span></span>
<span><span class="co">##                 Estimate Std. Error  z-value  Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept):B   4.643271   0.326871  14.2052 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## (Intercept):C   3.064061   0.265558  11.5382 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## (Intercept):D   7.196296   0.381254  18.8753 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## (Intercept):E   3.135687   0.384317   8.1591 4.441e-16 ***</span></span>
<span><span class="co">## ba              2.522109   0.232028  10.8699 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## SL:B           -0.287397   0.020177 -14.2439 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## SL:C           -0.123616   0.013827  -8.9404 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## SL:D           -0.471721   0.027866 -16.9284 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## SL:E           -0.206868   0.023638  -8.7516 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## pool_density:B -2.779382   1.261758  -2.2028   0.02761 *  </span></span>
<span><span class="co">## pool_density:C -2.444741   1.036089  -2.3596   0.01830 *  </span></span>
<span><span class="co">## pool_density:D  4.218638   1.893560   2.2279   0.02589 *  </span></span>
<span><span class="co">## pool_density:E  1.888220   2.093610   0.9019   0.36711    </span></span>
<span><span class="co">## SL:B            0.103055   0.077567   1.3286   0.18398    </span></span>
<span><span class="co">## SL:C            0.088743   0.053622   1.6550   0.09793 .  </span></span>
<span><span class="co">## SL:D           -0.365280   0.143431  -2.5467   0.01087 *  </span></span>
<span><span class="co">## SL:E           -0.059210   0.125880  -0.4704   0.63809    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Log-Likelihood: -2226.6</span></span>
<span><span class="co">## McFadden R^2:  0.22233 </span></span>
<span><span class="co">## Likelihood ratio test : chisq = 1273.1 (p.value = &lt; 2.22e-16)</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">dcmodel_sexless</span>, <span class="va">dcmodel</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 df      AIC</span></span>
<span><span class="co">## dcmodel_sexless 17 4487.120</span></span>
<span><span class="co">## dcmodel         49 4455.028</span></span></code></pre>
<p>The model including sex has a much better fit, but we’ll plot to
visualize the results anyways.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># removing sex-stage variable</span></span>
<span><span class="va">mock_sexless</span> <span class="op">&lt;-</span> <span class="va">mock_d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex_stage</span> <span class="op">==</span> <span class="st">"I"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">sex_stage</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generating predictions</span></span>
<span><span class="va">pred_mock_sexless</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">block</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex_stage</span> <span class="op">==</span> <span class="st">"I"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">sex_stage</span><span class="op">)</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">dcmodel_sexless</span>, newdata <span class="op">=</span> <span class="va">mock_sexless</span>, type <span class="op">=</span> <span class="st">"probs"</span><span class="op">)</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># reshaping</span></span>
<span><span class="va">pred_mock_sexless</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, <span class="va">C</span>, <span class="va">D</span>, <span class="va">E</span>, key <span class="op">=</span> <span class="va">habitat</span>, value <span class="op">=</span> <span class="va">probability</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>density <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html" class="external-link">mapvalues</a></span><span class="op">(</span><span class="va">pool_density</span>,</span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decreased"</span>, <span class="st">"control"</span>, <span class="st">"increased"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">density</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decreased"</span>, <span class="st">"control"</span>, <span class="st">"increased"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred_mock_sexless</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">SL</span>, y <span class="op">=</span> <span class="va">probability</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">density</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>, <span class="st">"dashed"</span>, <span class="st">"dotted"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">habitat</span> <span class="op">~</span><span class="va">.</span>, scales <span class="op">=</span> <span class="st">"free"</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>habitat <span class="op">=</span> <span class="fu">hablab</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Predictions of habitat use"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DME-035_DD_habitat_use_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Seba De Bona, Matthieu Bruneaux, Andrés López-Sepulcre.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
