<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tidy the data • guppyDme</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tidy the data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">guppyDme</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Analyses

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DME-000_Tidy_data.html">Tidy the Data</a>
    </li>
    <li>
      <a href="../articles/DME-011_Measurement_consistency.html">Measurement Consistency</a>
    </li>
    <li>
      <a href="../articles/DME-010_Habitat_characteristics.html">Habitat Characteristics</a>
    </li>
    <li>
      <a href="../articles/DME-015_Habitat_area.html">Habitat Area</a>
    </li>
    <li>
      <a href="../articles/DME-016_Dispersal_and_habitat_shift.html">Dispersal and Habitat shift</a>
    </li>
    <li>
      <a href="../articles/DME-020_Density_dependence.html">Density Dependence</a>
    </li>
    <li>
      <a href="../articles/DME-030_Habitat_use.html">Habitat Use</a>
    </li>
    <li>
      <a href="../articles/DME-035_DD_habitat_use.html">Density-Dependent Habitat Use</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sebastianodebona/guppyDme" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tidy the data</h1>
                        <h4 data-toc-skip class="author">Seba De
Bona</h4>
            
      

      <div class="hidden name"><code>DME-000_Tidy_data.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overwiew-setup">Overwiew &amp; setup<a class="anchor" aria-label="anchor" href="#overwiew-setup"></a>
</h2>
<p>This vignette handles data to obtain individual information across
the two recaptures, such as dispersal, habitat shift, and growth.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loading necessary packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># this requires the package guppyDme to be installed. If the user wishes not to install the package, please comment out the "library(guppyDme)" line and run instead the lines commented out below</span></span>
<span></span>
<span><span class="co">#### If you have the guppyDme package installed</span></span>
<span><span class="co"># loading package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sebastianodebona.github.io/guppyDme/">guppyDme</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># # If you do NOT wish to install the guppyDme package, please uncomment and run the following two lines of code, adding the package functions to the Global Environment and loading the data</span></span>
<span><span class="co"># source(file.path(here::here(), "R", "package_functions.R"))</span></span>
<span><span class="co"># load(file.path(here::here(), "data", "DMEdata.rda"))</span></span>
<span></span>
<span><span class="co"># loading data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">DMEdata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## tibble [2,930 × 21] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  $ processingDate: Date[1:2930], format: "2018-03-19" "2018-03-19" ...</span></span>
<span><span class="co">##  $ captureDate   : Date[1:2930], format: "2018-03-18" "2018-03-18" ...</span></span>
<span><span class="co">##  $ markID        : Factor w/ 2219 levels "105K","105Y",..: 643 781 731 539 581 476 795 814 461 518 ...</span></span>
<span><span class="co">##  $ tank          : chr [1:2930] "1" "1" "1" "1" ...</span></span>
<span><span class="co">##  $ bag           : int [1:2930] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">##  $ sex           : Factor w/ 4 levels "B","F","J","M": 2 2 2 4 2 2 2 4 3 2 ...</span></span>
<span><span class="co">##  $ SL            : chr [1:2930] "21.29" "20.62" "17.38" "17.64" ...</span></span>
<span><span class="co">##  $ weight        : num [1:2930] 0.183 0.155 0.071 0.086 0.106 0.057 0.061 0.077 0.068 0.086 ...</span></span>
<span><span class="co">##  $ stream        : Factor w/ 2 levels "CAIGUAL","TAYLOR": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ streamID      : Factor w/ 4 levels "CL1","CL2","TL",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ location      : chr [1:2930] "P10-15" "P10-15" "P10-15" "P10-15" ...</span></span>
<span><span class="co">##  $ habitat       : Factor w/ 5 levels "A","B","C","D",..: 4 4 4 4 4 4 4 4 4 4 ...</span></span>
<span><span class="co">##  $ treatment     : chr [1:2930] "I" "I" "I" "I" ...</span></span>
<span><span class="co">##  $ releaseDate   : Date[1:2930], format: "2018-03-21" "2018-03-21" ...</span></span>
<span><span class="co">##  $ markerID      : chr [1:2930] "DKS" "DKS" "DKS" "DKS" ...</span></span>
<span><span class="co">##  $ recap         : int [1:2930] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ formaline     : int [1:2930] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ comments      : chr [1:2930] "" "" "" "" ...</span></span>
<span><span class="co">##  $ patchID       : Factor w/ 33 levels "B8.5-9","N23-32",..: 7 7 7 7 7 7 7 7 7 7 ...</span></span>
<span><span class="co">##  $ isbabyMark    : logi [1:2930] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">##  $ isCohort      : logi [1:2930] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># including sex_stage variable and converting size into numeric</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>SL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">SL</span><span class="op">)</span>,</span>
<span>         sex_stage <span class="op">=</span> <span class="fu">score_sexst</span><span class="op">(</span><span class="va">.</span>, f_threshold <span class="op">=</span> <span class="fl">14.00</span>, f_unit <span class="op">=</span> <span class="st">"SL"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># I am here using the SL as a unit of threshold, since individuals preserved</span></span>
<span><span class="co"># in formaline don't have weight information</span></span>
<span></span>
<span><span class="co"># checking which individuals are missing a capture location</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">patchID</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 47 × 22</span></span></span>
<span><span class="co">##    processingDate captureDate markID tank    bag sex      SL weight stream</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2018-03-24     2018-03-22  1RX    21       <span style="color: #BB0000;">NA</span> J      18.8  0.106 TAYLOR</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2018-03-24     2018-03-22  1RX    21       <span style="color: #BB0000;">NA</span> J      18.2  0.093 TAYLOR</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2018-03-24     2018-03-22  1RX    21       <span style="color: #BB0000;">NA</span> M      18.7  0.096 TAYLOR</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2018-03-24     2018-03-22  1RX    21       <span style="color: #BB0000;">NA</span> F      25.1  0.248 TAYLOR</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2018-03-24     2018-03-22  1RX    21       <span style="color: #BB0000;">NA</span> F      25.6  0.193 TAYLOR</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2018-03-24     2018-03-22  1R2K6B 21       <span style="color: #BB0000;">NA</span> F      28.0  0.382 TAYLOR</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2018-03-24     2018-03-22  1RX    21       <span style="color: #BB0000;">NA</span> M      20.0  0.112 TAYLOR</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2018-03-24     2018-03-22  1RX    21       <span style="color: #BB0000;">NA</span> F      14.2  0.051 TAYLOR</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2018-03-24     2018-03-22  1RX    21       <span style="color: #BB0000;">NA</span> F      24.2  0.25  TAYLOR</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2018-03-24     2018-03-22  1RX    21       <span style="color: #BB0000;">NA</span> F      23.5  0.256 TAYLOR</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 37 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 13 more variables: streamID &lt;fct&gt;, location &lt;chr&gt;, habitat &lt;fct&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   treatment &lt;chr&gt;, releaseDate &lt;date&gt;, markerID &lt;chr&gt;, recap &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   formaline &lt;int&gt;, comments &lt;chr&gt;, patchID &lt;fct&gt;, isbabyMark &lt;lgl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   isCohort &lt;lgl&gt;, sex_stage &lt;chr&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># these individuals belong to two bottles that were accidentally mixed during processing.</span></span>
<span><span class="co"># individuals in it were not included in the experiment</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="spreading-and-shrinking-the-data">Spreading and shrinking the data<a class="anchor" aria-label="anchor" href="#spreading-and-shrinking-the-data"></a>
</h2>
<p>To analyse dispersal and habitat change we need to transform the
dataset from long to wide format (spread), reducing it to the recaptured
individuals only.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">captures</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="co"># we are here selecting all individuals that are not babies, cohort or in TM</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">recap</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">!</span><span class="va">isbabyMark</span>, <span class="op">!</span><span class="va">isCohort</span>, <span class="va">streamID</span> <span class="op">!=</span> <span class="st">"TM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">markID</span>, <span class="va">streamID</span>, <span class="va">treatment</span>, sex_stage_0 <span class="op">=</span> <span class="va">sex_stage</span>,</span>
<span>         patch_0 <span class="op">=</span> <span class="va">patchID</span>, habitat_0 <span class="op">=</span> <span class="va">habitat</span>,</span>
<span>         SL_0 <span class="op">=</span> <span class="va">SL</span>, weight_0 <span class="op">=</span> <span class="va">weight</span>, <span class="va">releaseDate</span>, marker_0 <span class="op">=</span> <span class="va">markerID</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">recaptures</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">recap</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">!</span><span class="va">isbabyMark</span>, <span class="op">!</span><span class="va">isCohort</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">markID</span>, </span>
<span>         patch_1 <span class="op">=</span> <span class="va">patchID</span>, habitat_1 <span class="op">=</span> <span class="va">habitat</span>, sex_stage_1 <span class="op">=</span> <span class="va">sex_stage</span>,</span>
<span>         SL_1 <span class="op">=</span> <span class="va">SL</span>, weight_1 <span class="op">=</span> <span class="va">weight</span>, <span class="va">captureDate</span>, marker_1 <span class="op">=</span> <span class="va">markerID</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># merging, but keeping only markIDs that are shared among the two datasets</span></span>
<span><span class="co"># (only recaptured individuals)</span></span>
<span><span class="va">cr_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">captures</span>, <span class="va">recaptures</span>, by <span class="op">=</span> <span class="st">"markID"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">cr_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## tibble [435 × 17] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  $ markID     : Factor w/ 2219 levels "105K","105Y",..: 643 781 731 539 581 795 814 461 635 303 ...</span></span>
<span><span class="co">##  $ streamID   : Factor w/ 4 levels "CL1","CL2","TL",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ treatment  : chr [1:435] "I" "I" "I" "I" ...</span></span>
<span><span class="co">##  $ sex_stage_0: chr [1:435] "F" "F" "F" "M" ...</span></span>
<span><span class="co">##  $ patch_0    : Factor w/ 33 levels "B8.5-9","N23-32",..: 7 7 7 7 7 7 7 7 7 7 ...</span></span>
<span><span class="co">##  $ habitat_0  : Factor w/ 5 levels "A","B","C","D",..: 4 4 4 4 4 4 4 4 2 2 ...</span></span>
<span><span class="co">##  $ SL_0       : num [1:435] 21.3 20.6 17.4 17.6 19 ...</span></span>
<span><span class="co">##  $ weight_0   : num [1:435] 0.183 0.155 0.071 0.086 0.106 0.061 0.077 0.068 0.13 0.485 ...</span></span>
<span><span class="co">##  $ releaseDate: Date[1:435], format: "2018-03-21" "2018-03-21" ...</span></span>
<span><span class="co">##  $ marker_0   : chr [1:435] "DKS" "DKS" "DKS" "DKS" ...</span></span>
<span><span class="co">##  $ patch_1    : Factor w/ 33 levels "B8.5-9","N23-32",..: 7 7 7 7 7 7 29 10 7 7 ...</span></span>
<span><span class="co">##  $ habitat_1  : Factor w/ 5 levels "A","B","C","D",..: 1 3 1 3 3 3 NA 3 3 1 ...</span></span>
<span><span class="co">##  $ sex_stage_1: chr [1:435] "F" "F" "F" "M" ...</span></span>
<span><span class="co">##  $ SL_1       : num [1:435] 22.4 19.3 17.2 17.5 19.7 ...</span></span>
<span><span class="co">##  $ weight_1   : num [1:435] 0.158 NA NA 0.099 0.131 NA 0.065 0.102 0.156 NA ...</span></span>
<span><span class="co">##  $ captureDate: Date[1:435], format: "2018-04-19" "2018-04-19" ...</span></span>
<span><span class="co">##  $ marker_1   : chr [1:435] "DKS" "SDB" "SDB" "DKS" ...</span></span></code></pre>
<p>There are 435 recapture events (out of 732 adults captured).</p>
<p>Let’s see how many individuals per treatment we are dealing with.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cr_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   treatment [6]</span></span></span>
<span><span class="co">##   treatment     n</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> C           159</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> D            51</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> E            50</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> I           103</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> N            70</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> <span style="color: #BB0000;">NA</span>            2</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cr_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 17</span></span></span>
<span><span class="co">##   markID streamID treatment sex_stage_0 patch_0 habitat_0  SL_0 weight_0</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 5V7Y   CL1      <span style="color: #BB0000;">NA</span>        I           PEX-CL  <span style="color: #BB0000;">NA</span>         15.2    0.057</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 6Y8W   CL1      <span style="color: #BB0000;">NA</span>        I           PEX-CL  <span style="color: #BB0000;">NA</span>         17.1    0.087</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 9 more variables: releaseDate &lt;date&gt;, marker_0 &lt;chr&gt;, patch_1 &lt;fct&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   habitat_1 &lt;fct&gt;, sex_stage_1 &lt;chr&gt;, SL_1 &lt;dbl&gt;, weight_1 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   captureDate &lt;date&gt;, marker_1 &lt;chr&gt;</span></span></span></code></pre>
<p>So far we’ve only dealt with adult individuals with a unique mark.
For cohort marks (i.e. individuals between 10 and 13 mm who received
only a single mark, assigning it to a size cohort, pool and habitat), we
need to take a different approach.</p>
<p>Cohort marks do not have unique marks, so we have to back-track their
information at capture (where they were, how long they were to 1mm
error, which habitat they were found in) based on that mark.</p>
<p>Once we’ve done this, we can add this information to the one
concerning the adults.</p>
<p>There are a few things to consider while subsetting for cohort marks.
Individuals that were removed from the decreased density pool are also
marked with a cohort mark (<code>"1R"</code>, <code>"1RX"</code>,
<code>"3R"</code> or <code>"1R2R"</code>). So we’ll need not to consider
these individuals.</p>
<p>Moreover, cohort marks given to individuals in the N treatment
(natural untouched pools) or added in the increased pool (E treatment)
were given a pool-specific only mark, with individuals from different
habitats and size classes sharing the same mark.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first, extracting information on capture</span></span>
<span><span class="va">cohort_captures</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">recap</span> <span class="op">==</span> <span class="fl">0</span>, </span>
<span>         <span class="va">isCohort</span>, <span class="op">!</span><span class="op">(</span><span class="va">markID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1R"</span>, <span class="st">"1RX"</span>, <span class="st">"1R2R"</span>, <span class="st">"3R"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         <span class="va">streamID</span> <span class="op">!=</span> <span class="st">"TM"</span>,</span>
<span>         <span class="op">!</span><span class="op">(</span><span class="va">treatment</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"E"</span>, <span class="st">"N"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<p>Each cohort mark should have been used in only one pool by size class
by habitat combination. Let’s check whether this is true.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reused_marks</span> <span class="op">&lt;-</span> <span class="va">cohort_captures</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># dividing in categorical size classes</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>size_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">SL</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">13</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">markID</span>, <span class="va">stream</span>, <span class="va">patchID</span>, <span class="va">habitat</span>, <span class="va">size_class</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">markID</span>, <span class="va">stream</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># the following code pulls out the markID which are repeated for more than one</span></span>
<span>  <span class="co"># habitat-size-pool combination in a stream.</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">nrow</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">markID</span>, <span class="va">stream</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/tee.html" class="external-link">%T&gt;%</a></span></span>
<span>  <span class="va">print</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'markID', 'stream', 'patchID', 'habitat'.</span></span>
<span><span class="co">## You can override using the `.groups` argument.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   markID, stream [1]</span></span></span>
<span><span class="co">##   markID stream</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 2P     TAYLOR</span></span></code></pre>
<p>We can now filter away the reused mark, and extract the pool,
habitat, position, and mean SL, together with the other information to
match it with the adults’.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_SL</span> <span class="op">&lt;-</span> <span class="va">cohort_captures</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">markID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">reused_marks</span><span class="op">$</span><span class="va">markID</span> <span class="op">&amp;</span> <span class="va">stream</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">reused_marks</span><span class="op">$</span><span class="va">stream</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">markID</span>, <span class="va">streamID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>SL_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">SL</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'markID'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NROW</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mean_SL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohort_captures</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="co"># removing reused marks</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">markID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">reused_marks</span><span class="op">$</span><span class="va">markID</span> <span class="op">&amp;</span> <span class="va">stream</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">reused_marks</span><span class="op">$</span><span class="va">stream</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># extracting only unique combinations (which should match the mean_SL)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">markID</span>, <span class="va">streamID</span>, <span class="va">stream</span>, <span class="va">treatment</span>, sex_stage_0 <span class="op">=</span> <span class="va">sex_stage</span>,</span>
<span>         patch_0 <span class="op">=</span> <span class="va">patchID</span>, habitat_0 <span class="op">=</span> <span class="va">habitat</span>, <span class="va">releaseDate</span><span class="op">)</span></span>
<span><span class="co"># checking whether we did obtain only unique rows, matching mean_SL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cohort_captures</span><span class="op">)</span> <span class="op">==</span> <span class="va">NROW</span><span class="op">)</span></span>
<span><span class="co"># merging (and adding a column of NAs for the initial weight)</span></span>
<span><span class="va">cohort_captures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">cohort_captures</span>, <span class="va">mean_SL</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span>weight_0 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(markID, streamID)`</span></span></code></pre>
<p>Similarly to what was done for the adults, we can extract the data
for the recaptures, and merge the capture data into it. We don’t need
here to remove any mark yet, since we will inner merge so all marks we
already removed from the capture data (reused marks, removed
individuals) will be dropped here.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohort_recaptures</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">recap</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">isCohort</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">markID</span>, </span>
<span>         <span class="va">stream</span>, patch_1 <span class="op">=</span> <span class="va">patchID</span>, habitat_1 <span class="op">=</span> <span class="va">habitat</span>, sex_stage_1 <span class="op">=</span> <span class="va">sex_stage</span>,</span>
<span>         SL_1 <span class="op">=</span> <span class="va">SL</span>, weight_1 <span class="op">=</span> <span class="va">weight</span>, <span class="va">captureDate</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># merging</span></span>
<span><span class="va">cr_cohorts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">cohort_captures</span>, <span class="va">cohort_recaptures</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"markID"</span>, <span class="st">"stream"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We now need to be careful, before adding the rows for the cohort
individuals, to have the same variables in the cohort dataset.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># checking if any variable that is present in cr_data is missing</span></span>
<span><span class="co"># in cr_cohorts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cr_data</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cr_cohorts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## FALSE  TRUE </span></span>
<span><span class="co">##    15     2</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># no variables missing</span></span>
<span></span>
<span><span class="co"># now checking if there are extra variables in cr_cohorts that are not in cr_data</span></span>
<span><span class="va">extra_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cr_cohorts</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cr_cohorts</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cr_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># before proceeding I need to remove this variable(s)</span></span>
<span><span class="va">cr_cohorts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">extra_var</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can add the rows to the main dataset <code>cr_data</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cr_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">cr_data</span>, <span class="va">cr_cohorts</span><span class="op">)</span></span></code></pre></div>
<p>It’s useful to know what was the <em>pool-specific</em> habitat of
the patch individuals move to or from. For instance, individuals could
be released in a specific treatment (control, increased, decreased) and
move to a different pool with anther treatment.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for the starting pool is fine, since the pool treatment can be</span></span>
<span><span class="co"># derived from the individual treatment</span></span>
<span><span class="va">cr_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pool_treat_0 <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">treatment</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span> <span class="op">=</span> <span class="st">"control"</span>,</span>
<span>                                          <span class="st">"D"</span> <span class="op">=</span> <span class="st">"decreased"</span>,</span>
<span>                                          <span class="st">"I"</span> <span class="op">=</span> <span class="st">"increased"</span>,</span>
<span>                                          <span class="st">"E"</span> <span class="op">=</span> <span class="st">"increased"</span>,</span>
<span>                                          <span class="st">"N"</span> <span class="op">=</span> <span class="st">"natural"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         pool_treat_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pool_treat_0</span><span class="op">)</span>, <span class="st">"natural"</span>, <span class="va">pool_treat_0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for the arrival pool is a little trickier. I need to create</span></span>
<span><span class="co"># a key that matches pools to their treatment type.</span></span>
<span><span class="va">pool_to_treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span></span>
<span>  <span class="va">cr_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"I"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">streamID</span>, <span class="va">patch_0</span>, <span class="va">treatment</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'streamID', 'patch_0'. You can override</span></span>
<span><span class="co">## using the `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now I can transform the treatment into its spelled-out form</span></span>
<span><span class="co"># and add it to the cr_data for the recapture pools</span></span>
<span><span class="va">ptt_table</span> <span class="op">&lt;-</span> <span class="va">pool_to_treat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pool_treat_1 <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">treatment</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span> <span class="op">=</span> <span class="st">"control"</span>,</span>
<span>                                          <span class="st">"D"</span> <span class="op">=</span> <span class="st">"decreased"</span>,</span>
<span>                                          <span class="st">"I"</span> <span class="op">=</span> <span class="st">"increased"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>patch_1 <span class="op">=</span> <span class="va">patch_0</span>, <span class="va">pool_treat_1</span><span class="op">)</span></span>
<span><span class="co"># I here removed treatment and renamed the pool (0 to 1) to ease the merge</span></span>
<span><span class="co"># pool_0 was used to extract the type of treatment, by now I need to apply</span></span>
<span><span class="co"># that treatment to the arrival pool (1)</span></span>
<span><span class="co"># I also removed streamID, to account for fish that moved from CL1 to CL2.</span></span>
<span><span class="co"># pool names cannot be confounded between streams in any case.</span></span>
<span></span>
<span><span class="co"># merging pool_treat_1 info and replacing NAs (all that is not control, increased</span></span>
<span><span class="co"># or decreased) with "natural"</span></span>
<span><span class="va">cr_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">ptt_table</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pool_treat_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pool_treat_1</span><span class="op">)</span>, <span class="st">"natural"</span>, <span class="va">pool_treat_1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(patch_1)`</span></span></code></pre>
<p>There is one more necessary change to avoid confusion. The variable
<code>patch_0</code> is extracted from the main dataset and refer to the
location where an individual was <em>captured</em>. In the case of
extra-limital individuals that were introduced in the increased-density
pool, this of course does not correspond to the location where
individuals were released. This would be, in fact, the increased density
pool. Leaving patch_0 as it is now will cause us to overestimate
dispersal, considering a dispersal event when individuals were
artificially moved from “PEX” to the increased density pool. This will
not be a problem, as long as we exclude the extra-limital individuals
(treatment “E”) from the analysis, as we should. But just in case, lets
fix it.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># checking which are the increased pools</span></span>
<span><span class="va">pool_to_treat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"I"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">##   streamID patch_0  treatment</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> CL1      P10-15   I        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> CL2      P53.5-56 I        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> TL       P24-29.5 I</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># replacing PEX with actual release pool</span></span>
<span><span class="va">cr_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>patch_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">patch_0</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">==</span> <span class="st">"PEX"</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"PEX"</span>, <span class="va">streamID</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">patch_0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>patch_0 <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">patch_0</span>,</span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PEX-CL1"</span> <span class="op">=</span> <span class="st">"P10-15"</span>,</span>
<span>                                     <span class="st">"PEX-CL2"</span> <span class="op">=</span> <span class="st">"P53.5-56"</span>,</span>
<span>                                     <span class="st">"PEX-TL"</span> <span class="op">=</span> <span class="st">"P24-29.5"</span><span class="op">)</span></span>
<span>                                   <span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="growth-dispersal-habitat-shift">Growth, dispersal, habitat shift<a class="anchor" aria-label="anchor" href="#growth-dispersal-habitat-shift"></a>
</h2>
<p>We can now check whether individuals have dispersed or changed
habitat in the time between the two captures. We can also estimate the
growth in mm, and the time between capture and recapture. We can
calculate time in days comparing the release time after the first
capture with the capture time of the recapture.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># an individual is considered dispersed if the patch ID between 0 and 1 (cap and recap)</span></span>
<span><span class="co"># is different. Since in the prep-data step we have established unique patchIDs between</span></span>
<span><span class="co"># capture and recapture event, this correponds to an actual movement.</span></span>
<span><span class="va">cr_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>moved <span class="op">=</span> <span class="va">patch_0</span> <span class="op">!=</span> <span class="va">patch_1</span>,</span>
<span>         hshift <span class="op">=</span> <span class="va">habitat_0</span> <span class="op">!=</span> <span class="va">habitat_1</span>,</span>
<span>         interval <span class="op">=</span> <span class="va">captureDate</span> <span class="op">-</span> <span class="va">releaseDate</span>,</span>
<span>         growth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">SL_1</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">SL_0</span><span class="op">)</span><span class="op">)</span></span>
<span>         <span class="op">)</span></span></code></pre></div>
<p>The last necessary step is to calculate the actual percentages of
increase and decrease in density over the treatments. The aim of the
manipulation was to modify density by 40 (CL1), 50 (TL) and 60% (CL2).
But the actual proportion can be calculated from the capture form.</p>
<p>Before proceeding, here explained what the treatment levels (quite a
few) mean:</p>
<ul>
<li>C: control treatment. Fish assigned to this treatment were captured
and released in the same control pool. Density here is unaltered.</li>
<li>I: increased treatment. Fish captured in the pool to be increased.
This are the resident fish, which would be reintroduced in the increased
density pool, together with other fish (see below). The analyses of the
effects of density will be restricted to these resident fish,
experiencing higher density.</li>
<li>E: extralimital fish. Fish captured elsewhere (outside the
manipulated reach), to be introduced in the increased treatment. The
analyses won’t concern this fish since they’re movement is likely to be
affected by them being displaced, in addition to density.</li>
<li>D: decreased fish. Fish captured in the pool where density will be
decreased, and that will be released back into the same pool. These are
the resident fish that stay, to experience to lower density.</li>
<li>R: removed fish. Fish captured in the pool where density will be
decreased, but that won’t be released back into the same pool. They will
be displaced downstream, allowing a decrease in density.</li>
<li>XR: accidentally removed fish. In TL two bottles belonging to
different pools were mixed together by accident, in the laboratory.
These 20+27 fish were removed from the reach. The pool marked XR are the
fish that are considered as removed from the decreased density pool (one
of the mixed up pools). These fish will be counted when establishing how
many fish were removed from TL.</li>
<li>X: accidentally removed fish, from the increased density pool. These
fish were also mixed up (see above). We had to remove them from the
increased pool. These fish will be counted when establishing the
original density of the increased pool in TL.</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we only need capture data</span></span>
<span><span class="va">all_capture</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">recap</span> <span class="op">==</span> <span class="fl">0</span>, <span class="va">streamID</span> <span class="op">!=</span> <span class="st">"TM"</span><span class="op">)</span></span></code></pre></div>
<p>We can now summarise the data by <code>streamID</code> and
<code>treatment</code>, and transform into a wide format</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment_tab</span> <span class="op">&lt;-</span> <span class="va">all_capture</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">streamID</span>, <span class="va">treatment</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">count</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">spread</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">print</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 9</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   streamID [3]</span></span></span>
<span><span class="co">##   streamID     C     D     E     I     N     R     X    XR</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> CL1        193    42    73   163    55    26    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> CL2        106    60    31    49    47    89    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> TL         100    28    52    63   111     8    27    20</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># with operations among columns I can now calculate increase and decrease percentages.</span></span>
<span><span class="va">treatment_tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Incr_p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span>, <span class="va">E</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span>, <span class="va">X</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>         Decr_p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">D</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">D</span>, <span class="va">R</span>, <span class="va">XR</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">print</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 11</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   streamID [3]</span></span></span>
<span><span class="co">##   streamID     C     D     E     I     N     R     X    XR Incr_p Decr_p</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> CL1        193    42    73   163    55    26    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   1.45   0.62</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> CL2        106    60    31    49    47    89    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   1.63   0.4 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> TL         100    28    52    63   111     8    27    20   1.28   0.5</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># see above what is the meaning of the treatment levels here</span></span></code></pre></div>
<p>We can reshape this table in a better way to facilitate merging.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment_tab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">streamID</span>, <span class="va">Incr_p</span>, <span class="va">Decr_p</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Contr_p <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># the control was always left intact</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">density_factor</span>, <span class="va">Incr_p</span><span class="op">:</span><span class="va">Contr_p</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># wide to long format</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="co"># using same nomenclature as treatment levels</span></span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Incr_p"</span> <span class="op">=</span> <span class="st">"I"</span>,</span>
<span>                                     <span class="st">"Decr_p"</span> <span class="op">=</span> <span class="st">"D"</span>,</span>
<span>                                     <span class="st">"Contr_p"</span> <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">print</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 3</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   streamID [3]</span></span></span>
<span><span class="co">##   streamID treatment density_factor</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> CL1      I                   1.45</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> CL2      I                   1.63</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> TL       I                   1.28</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> CL1      D                   0.62</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> CL2      D                   0.4 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> TL       D                   0.5 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> CL1      C                   1   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> CL2      C                   1   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span> TL       C                   1</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#...and merge</span></span>
<span><span class="va">cr_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">cr_data</span>, <span class="va">treatment_tab</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(streamID, treatment)`</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">cr_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## tibble [484 × 24] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  $ markID        : Factor w/ 2219 levels "105K","105Y",..: 643 781 731 539 581 795 814 461 635 303 ...</span></span>
<span><span class="co">##  $ streamID      : Factor w/ 4 levels "CL1","CL2","TL",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ treatment     : chr [1:484] "I" "I" "I" "I" ...</span></span>
<span><span class="co">##  $ sex_stage_0   : chr [1:484] "F" "F" "F" "M" ...</span></span>
<span><span class="co">##  $ patch_0       : chr [1:484] "P10-15" "P10-15" "P10-15" "P10-15" ...</span></span>
<span><span class="co">##  $ habitat_0     : Factor w/ 5 levels "A","B","C","D",..: 4 4 4 4 4 4 4 4 2 2 ...</span></span>
<span><span class="co">##  $ SL_0          : num [1:484] 21.3 20.6 17.4 17.6 19 ...</span></span>
<span><span class="co">##  $ weight_0      : num [1:484] 0.183 0.155 0.071 0.086 0.106 0.061 0.077 0.068 0.13 0.485 ...</span></span>
<span><span class="co">##  $ releaseDate   : Date[1:484], format: "2018-03-21" "2018-03-21" ...</span></span>
<span><span class="co">##  $ marker_0      : chr [1:484] "DKS" "DKS" "DKS" "DKS" ...</span></span>
<span><span class="co">##  $ patch_1       : Factor w/ 33 levels "B8.5-9","N23-32",..: 7 7 7 7 7 7 29 10 7 7 ...</span></span>
<span><span class="co">##  $ habitat_1     : Factor w/ 5 levels "A","B","C","D",..: 1 3 1 3 3 3 NA 3 3 1 ...</span></span>
<span><span class="co">##  $ sex_stage_1   : chr [1:484] "F" "F" "F" "M" ...</span></span>
<span><span class="co">##  $ SL_1          : num [1:484] 22.4 19.3 17.2 17.5 19.7 ...</span></span>
<span><span class="co">##  $ weight_1      : num [1:484] 0.158 NA NA 0.099 0.131 NA 0.065 0.102 0.156 NA ...</span></span>
<span><span class="co">##  $ captureDate   : Date[1:484], format: "2018-04-19" "2018-04-19" ...</span></span>
<span><span class="co">##  $ marker_1      : chr [1:484] "DKS" "SDB" "SDB" "DKS" ...</span></span>
<span><span class="co">##  $ pool_treat_0  : chr [1:484] "increased" "increased" "increased" "increased" ...</span></span>
<span><span class="co">##  $ pool_treat_1  : chr [1:484] "increased" "increased" "increased" "increased" ...</span></span>
<span><span class="co">##  $ moved         : logi [1:484] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">##  $ hshift        : logi [1:484] TRUE TRUE TRUE TRUE TRUE TRUE ...</span></span>
<span><span class="co">##  $ interval      : 'difftime' num [1:484] 29 29 29 29 ...</span></span>
<span><span class="co">##   ..- attr(*, "units")= chr "days"</span></span>
<span><span class="co">##  $ growth        : num [1:484] 1.13 -1.36 -0.14 -0.16 0.67 ...</span></span>
<span><span class="co">##  $ density_factor: num [1:484] 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 ...</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the info on pool-specific treatment is useful to have here too</span></span>
<span><span class="co"># so we will merge it into this</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">treatment_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">pool_to_treat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>patchID <span class="op">=</span> <span class="va">patch_0</span><span class="op">)</span>, <span class="va">treatment_tab</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(streamID, treatment)`</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">##   streamID patchID  treatment density_factor</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> CL1      P10-15   I                   1.45</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> CL1      P16-22   C                   1   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> CL1      P3-10    D                   0.62</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> CL2      P48-53.5 C                   1   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> CL2      P53.5-56 I                   1.63</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> CL2      P59-68.5 D                   0.4</span></span></code></pre>
<p>The newly added variable <code>density_factor</code> allows to use
density as a continous variable in the analyses.</p>
</div>
<div class="section level2">
<h2 id="saving">Saving<a class="anchor" aria-label="anchor" href="#saving"></a>
</h2>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># saving the cr dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">cr_data</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignettes"</span>, <span class="st">"DME_cr_data.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># and also the treatment table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">treatment_tab</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignettes"</span>, <span class="st">"DME_density_factor_in_treatments.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Seba De Bona, Matthieu Bruneaux, Andrés López-Sepulcre.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
